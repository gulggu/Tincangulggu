<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>텍스트 → 이미지 변환기</title>
    <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
        }
        #color-picker {
            margin: 20px auto;
        }
        canvas {
            border: 1px solid black;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <h1>텍스트 → 이미지 변환기</h1>

    <!-- 색상 선택기 -->
    <div id="color-picker"></div>
    <input type="hidden" id="selected-color">

    <!-- 텍스트 입력 -->
    <input type="text" id="user-text" placeholder="이미지에 들어갈 텍스트">
    
    <!-- 미리보기 캔버스 -->
    <h3>미리보기</h3>
    <canvas id="preview-canvas" width="800" height="400"></canvas>

    <!-- 이미지 생성 버튼 -->
    <button id="generate-btn">이미지 생성</button>

    <!-- 최종 출력 캔버스 -->
    <h3>생성된 이미지</h3>
    <canvas id="output-canvas" width="800" height="400"></canvas>
    
    <!-- 다운로드 버튼 -->
    <button id="download-btn">이미지 다운로드</button>

    <script>
        // 🔹 RGBA 색상 선택기 설정
        const colorPicker = new iro.ColorPicker("#color-picker", {
            width: 200,
            color: "rgba(255, 0, 0, 1)", // 기본 색상 (빨강)
            layout: [
                { component: iro.ui.Wheel }, 
                { component: iro.ui.Slider, options: { sliderType: 'alpha' } } // 불투명도 조절 슬라이더
            ]
        });

        // 선택된 색상을 hidden input에 저장
        colorPicker.on("color:change", function(color) {
            document.getElementById("selected-color").value = color.rgbaString;
            updatePreview();
        });

        // 🔹 미리보기 캔버스 설정
        const previewCanvas = document.getElementById("preview-canvas");
        const previewCtx = previewCanvas.getContext("2d");

        function updatePreview() {
            previewCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);

            // 배경색 설정
            const selectedColor = document.getElementById("selected-color").value || "white";
            previewCtx.fillStyle = selectedColor;
            previewCtx.fillRect(0, 0, previewCanvas.width, previewCanvas.height);

            // 입력된 텍스트 가져오기
            const userText = document.getElementById("user-text").value || "미리보기 텍스트";
            
            // 텍스트 스타일
            previewCtx.fillStyle = "black";
            previewCtx.font = "30px Arial";
            previewCtx.textAlign = "center";
            previewCtx.fillText(userText, previewCanvas.width / 2, previewCanvas.height / 2);
        }

        // 입력값 변경 시 미리보기 업데이트
        document.getElementById("user-text").addEventListener("input", updatePreview);

        // 🔹 이미지 생성 버튼 기능
        document.getElementById("generate-btn").addEventListener("click", function() {
            const canvas = document.getElementById("output-canvas");
            const ctx = canvas.getContext("2d");

            // 캔버스 초기화
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 배경색 적용
            const selectedColor = document.getElementById("selected-color").value || "white";
            ctx.fillStyle = selectedColor;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 텍스트 가져오기
            const userText = document.getElementById("user-text").value || "출력할 텍스트";

            // 텍스트 스타일
            ctx.fillStyle = "black";
            ctx.font = "30px Arial";
            ctx.textAlign = "center";
            ctx.fillText(userText, canvas.width / 2, canvas.height / 2);
        });

        // 🔹 이미지 다운로드 버튼 기능
        document.getElementById("download-btn").addEventListener("click", function() {
            const canvas = document.getElementById("output-canvas");
            const link = document.createElement("a");
            link.download = "generated_image.png";
            link.href = canvas.toDataURL();
            link.click();
        });

        // 초기 미리보기 설정
        updatePreview();
    </script>

</body>
</html>
